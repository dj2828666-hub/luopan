 <!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>专业风水罗盘</title>
    <style>
        :root { --gold: #d4af37; --red: #ff3b30; }
        html, body { height: 100%; width: 100%; margin: 0; background: #000; overflow: hidden; color: var(--gold); font-family: sans-serif; }
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* 顶部信息 */
        #info-box { text-align: center; margin-bottom: 20px; display: none; }
        #degree-val { font-size: 3.5rem; font-weight: bold; color: #fff; margin: 0; }
        #gua-val { font-size: 1.2rem; background: rgba(211,175,55,0.2); padding: 5px 15px; border-radius: 20px; }

        /* 罗盘容器 */
        .compass-container { position: relative; width: 85vw; height: 85vw; max-width: 380px; display: none; align-items: center; justify-content: center; }
        
        /* 旋转盘面 */
        #disk { width: 100%; height: 100%; border-radius: 50%; border: 6px solid var(--gold); position: relative; transition: transform 0.05s linear; background: #1a0505; overflow: hidden; }

        /* 十字线 */
        .line { position: absolute; background: var(--red); z-index: 50; pointer-events: none; }
        .h-line { width: 110%; height: 1px; }
        .v-line { width: 1px; height: 110%; }

        /* 九宫格 */
        .nine-grid { position: absolute; top: 20%; left: 20%; width: 60%; height: 60%; display: grid; grid-template-columns: repeat(3, 1fr); border: 1px solid var(--gold); z-index: 10; }
        .cell { border: 0.5px solid rgba(212,175,55,0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; }
        .cell b { font-size: 13px; color: #fff; }

        /* 开始按钮 - 确保显眼 */
        #start-btn { padding: 20px 40px; font-size: 1.5rem; background: var(--gold); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; z-index: 100; box-shadow: 0 0 20px rgba(212,175,55,0.5); }
    </style>
</head>
<body>

    <button id="start-btn">点击开启罗盘</button>

    <div id="info-box">
        <p id="degree-val">0°</p>
        <span id="gua-val">校准中...</span>
    </div>

    <div class="compass-container" id="ui">
        <div class="line h-line"></div><div class="line v-line"></div>
        <div id="disk">
            <div class="nine-grid">
                <div class="cell"><b>巽四</b><br>木(长女)</div>
                <div class="cell"><b>离九</b><br>火(中女)</div>
                <div class="cell"><b>坤二</b><br>土(母亲)</div>
                <div class="cell"><b>震三</b><br>木(长男)</div>
                <div class="cell"><b>中宫</b><br>土</div>
                <div class="cell"><b>兑七</b><br>金(少女)</div>
                <div class="cell"><b>艮八</b><br>土(少男)</div>
                <div class="cell"><b>坎一</b><br>水(中男)</div>
                <div class="cell"><b>乾六</b><br>金(父亲)</div>
            </div>
        </div>
    </div>

    <script>
        const btn = document.getElementById('start-btn');
        const ui = document.getElementById('ui');
        const info = document.getElementById('info-box');
        const disk = document.getElementById('disk');

        btn.onclick = () => {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(s => { 
                    if(s === 'granted') start();
                    else alert("需要授权才能使用指南针");
                }).catch(e => alert("权限请求错误: " + e));
            } else {
                start();
            }
        };

        function start() {
            btn.style.display = 'none';
            ui.style.display = 'flex';
            info.style.display = 'block';
            window.addEventListener('deviceorientation', e => {
                let h = e.webkitCompassHeading || 0;
                disk.style.transform = `rotate(${-h}deg)`;
                document.getElementById('degree-val').innerText = Math.round(h) + "°";
                
                const gs = [
                    {n:"坎一·水(中男)", min:337.5, max:22.5}, {n:"艮八·土(少男)", min:22.5, max:67.5},
                    {n:"震三·木(长男)", min:67.5, max:112.5}, {n:"巽四·木(长女)", min:112.5, max:157.5},
                    {n:"离九·火(中女)", min:157.5, max:202.5}, {n:"坤二·土(母亲)", min:202.5, max:247.5},
                    {n:"兑七·金(少女)", min:247.5, max:292.5}, {n:"乾六·金(父亲)", min:292.5, max:337.5}
                ];
                let res = "定位中...";
                for (let g of gs) {
                    if (g.min > g.max) { if (h >= g.min || h < g.max) { res = g.n; break; } }
                    else { if (h >= g.min && h < g.max) { res = g.n; break; } }
                }
                document.getElementById('gua-val').innerText = res;
            }, true);
        }
    </script>
</body>
</html>
